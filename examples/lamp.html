<html>
<head>
  <meta charset="utf-8">

  <script src="../src/jquery-3.6.0.min.js"></script>
  <script src="../src/crypto/wasm_exec.js"></script>
  <script src="../src/crypto/crypto.js"></script>
  <script src="../src/colonyruntime.js"></script>

</head>
<body>
  <img id="lamp" src="./lamp_off.png">
  <script>
    $(function() {
      let colonyid = "2c50e2962040a934d844f8c4015e0e2a219c679236794fa85435d4ec8edd0838"
      let runtimeid = "4c795fd50993abd7d88c2520ae09a61ceb64ccbe6bca9c512ee706071f56c342"
      let runtime_prvkey = "9714cd7ee15584a20acf76fb2ca4b45a61778996c4a5cbb33dd27ae866d1457b"
      let runtime = new ColonyRuntime("colonyos.io", "50080")
      runtime.load()
      .then(() => {
        runtime.subscribe_processes("lamp", 0, runtime_prvkey, function(processes) {
          runtime.assign(colonyid, runtime_prvkey).then((process, err) => {
            lamp_state = process.attributes[0].value
            if (lamp_state == "on") {
              $("#lamp").attr("src","./lamp_on.png");
            }
            if (lamp_state == "off") {
              $("#lamp").attr("src","./lamp_off.png");
            }

            runtime.close_process(process.processid, true, runtime_prvkey)
          }) 
        })
      });
    });
  </script>
</body>
</html>
